---
- name: Reaccionar a alerta de Prometheus
  hosts: localhost
  gather_facts: false
  vars:
    alert: {}
  tasks:
    - name: Log de la alerta
      ansible.builtin.debug:
        msg: >
          Recibida alerta {{ alert.status }} - {{ (alert.alerts|first).labels.alertname }}
          en instancia {{ (alert.alerts|first).labels.instance }}

    # Ejemplos de acciones:
    - name: Si TargetDown cr√≠tico, intentar reiniciar Deployment en OpenShift
      when: "(alert.alerts|first).labels.alertname == 'TargetDown' and (alert.alerts|first).labels.severity == 'critical'"
      ansible.builtin.shell: |
        oc rollout restart deploy/mini-repo -n demo-eda
      changed_when: true